---
phase: 02-pos-core
plan: 07
type: execute
wave: 4
depends_on: ["02-02", "02-04"]
files_modified:
  - apps/web/app/[locale]/menu/[slug]/page.tsx
  - apps/web/app/[locale]/menu/[slug]/layout.tsx
  - apps/api/apps/menu/views.py
  - apps/api/apps/menu/urls.py
  - apps/web/components/menu/PublicMenuGrid.tsx
  - apps/web/components/menu/PublicMenuItemCard.tsx
  - apps/web/components/menu/CustomerCart.tsx
  - apps/web/components/menu/CustomerCheckout.tsx
autonomous: true

must_haves:
  truths:
    - "Customer can scan QR code and view restaurant menu"
    - "Menu page is publicly accessible (no login required)"
    - "Customer can add items to cart with modifiers"
    - "Customer can submit order from their phone"
    - "Menu displays restaurant name and branding"
    - "Order confirmation shows estimated wait time"
  artifacts:
    - path: "apps/web/app/[locale]/menu/[slug]/page.tsx"
      provides: "Public menu page"
      contains: "PublicMenuGrid"
    - path: "apps/api/apps/menu/views.py"
      provides: "Public menu endpoint"
      contains: "PublicMenuView"
    - path: "apps/web/components/menu/CustomerCart.tsx"
      provides: "Customer cart component"
      contains: "CustomerCart"
  key_links:
    - from: "apps/web/app/[locale]/menu/[slug]/page.tsx"
      to: "/api/v1/menu/public/"
      via: "Public menu fetch"
      pattern: "fetch.*public"
    - from: "apps/web/components/menu/CustomerCheckout.tsx"
      to: "/api/v1/orders/"
      via: "Order submission"
      pattern: "createOrder"
---

<objective>
Build the customer-facing QR menu page where customers can view menu and place orders from their phones.

Purpose: Enable customers to order directly from their table by scanning a QR code. This reduces staff workload and improves order accuracy.

Output: Public menu page at /menu/[restaurant-slug] with cart and self-ordering capability.
</objective>

<execution_context>
@C:\Users\dell\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dell\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-pos-core/02-RESEARCH.md

# Depends on orders API and frontend foundation
@.planning/phases/02-pos-core/02-02-SUMMARY.md
@.planning/phases/02-pos-core/02-04-SUMMARY.md

# Menu types and API
@apps/web/lib/api/types.ts
@apps/api/apps/menu/views.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create public menu API endpoint</name>
  <files>
    apps/api/apps/menu/views.py
    apps/api/apps/menu/urls.py
  </files>
  <action>
    1. Add public menu view to apps/api/apps/menu/views.py:
       ```python
       from rest_framework.views import APIView
       from rest_framework.response import Response
       from rest_framework.permissions import AllowAny
       from django.shortcuts import get_object_or_404
       from apps.authentication.models import Restaurant
       from .models import Category
       from .serializers import CategorySerializer

       class PublicMenuView(APIView):
           """
           Public endpoint for customer menu viewing.
           No authentication required.
           Returns full menu for a restaurant by slug.
           """
           permission_classes = [AllowAny]
           authentication_classes = []  # No auth needed

           def get(self, request, slug):
               restaurant = get_object_or_404(Restaurant, slug=slug, is_active=True)

               categories = Category.objects.filter(
                   restaurant=restaurant,
                   is_visible=True
               ).prefetch_related(
                   'items__modifiers__options'
               ).order_by('display_order')

               # Filter to only available items
               serializer = CategorySerializer(categories, many=True)
               data = serializer.data

               # Remove unavailable items from response
               for category in data:
                   category['items'] = [
                       item for item in category['items']
                       if item.get('is_available', True)
                   ]

               return Response({
                   'restaurant': {
                       'id': str(restaurant.id),
                       'name': restaurant.name,
                       'slug': restaurant.slug,
                       'address': restaurant.address,
                       'phone': restaurant.phone,
                   },
                   'categories': data
               })


       class PublicOrderCreateView(APIView):
           """
           Public endpoint for customer order creation.
           No authentication required - creates guest order.
           """
           permission_classes = [AllowAny]
           authentication_classes = []

           def post(self, request, slug):
               from apps.orders.serializers import OrderCreateSerializer
               from apps.orders.models import Order

               restaurant = get_object_or_404(Restaurant, slug=slug, is_active=True)

               # Add restaurant to request data
               data = request.data.copy()
               data['is_guest_order'] = True

               # Create order with restaurant context
               serializer = OrderCreateSerializer(data=data, context={
                   'request': request,
                   'restaurant': restaurant
               })
               serializer.is_valid(raise_exception=True)
               order = serializer.save(restaurant=restaurant)

               return Response({
                   'id': str(order.id),
                   'order_number': order.order_number,
                   'status': order.status,
                   'total': order.total,
                   'estimated_wait': 15,  # Default 15 min, can be dynamic later
               }, status=201)
       ```

    2. Update apps/api/apps/menu/urls.py to add public routes:
       ```python
       from django.urls import path, include
       from rest_framework.routers import DefaultRouter
       from . import views

       router = DefaultRouter()
       router.register('categories', views.CategoryViewSet, basename='category')
       router.register('items', views.MenuItemViewSet, basename='menuitem')
       router.register('modifiers', views.ModifierViewSet, basename='modifier')
       router.register('modifier-options', views.ModifierOptionViewSet, basename='modifieroption')

       urlpatterns = [
           path('', include(router.urls)),
           path('full/', views.FullMenuView.as_view(), name='full-menu'),
           # Public endpoints (no auth)
           path('public/<slug:slug>/', views.PublicMenuView.as_view(), name='public-menu'),
           path('public/<slug:slug>/order/', views.PublicOrderCreateView.as_view(), name='public-order'),
       ]
       ```

    3. Update OrderCreateSerializer to handle guest orders:
       In apps/api/apps/orders/serializers.py, update OrderCreateSerializer.create():
       ```python
       def create(self, validated_data):
           # ... existing code ...

           # Handle guest orders (no created_by)
           restaurant = self.context.get('restaurant')
           if restaurant:
               order = Order.objects.create(
                   restaurant=restaurant,
                   created_by=None,  # Guest order
                   **order_data
               )
           else:
               # Authenticated order
               user = self.context['request'].user
               order = Order.objects.create(
                   restaurant=user.restaurant,
                   created_by=user,
                   **order_data
               )

           # ... rest of creation logic ...
       ```
  </action>
  <verify>curl http://localhost:8000/api/v1/menu/public/test-restaurant/ returns menu</verify>
  <done>Public menu and order endpoints ready</done>
</task>

<task type="auto">
  <name>Task 2: Create public menu page structure</name>
  <files>
    apps/web/app/[locale]/menu/[slug]/layout.tsx
    apps/web/app/[locale]/menu/[slug]/page.tsx
    apps/web/lib/hooks/usePublicMenu.ts
  </files>
  <action>
    1. Create apps/web/lib/hooks/usePublicMenu.ts:
       ```typescript
       'use client';

       import { useQuery } from '@tanstack/react-query';
       import { Category } from '@/lib/api/types';

       interface Restaurant {
         id: string;
         name: string;
         slug: string;
         address: string;
         phone: string;
       }

       interface PublicMenuResponse {
         restaurant: Restaurant;
         categories: Category[];
       }

       export function usePublicMenu(slug: string) {
         return useQuery({
           queryKey: ['public-menu', slug],
           queryFn: async (): Promise<PublicMenuResponse> => {
             const apiUrl = process.env.NEXT_PUBLIC_API_URL || '';
             const response = await fetch(`${apiUrl}/api/v1/menu/public/${slug}/`);

             if (!response.ok) {
               if (response.status === 404) {
                 throw new Error('Restaurant not found');
               }
               throw new Error('Failed to load menu');
             }

             return response.json();
           },
           staleTime: 5 * 60 * 1000, // 5 minutes
           retry: 2,
         });
       }

       interface CreateOrderPayload {
         order_type: 'dine_in' | 'takeout';
         table?: string;
         customer_name: string;
         customer_phone: string;
         items: {
           menu_item_id: string;
           quantity: number;
           notes?: string;
           modifiers: { modifier_option_id: string }[];
         }[];
       }

       interface OrderResponse {
         id: string;
         order_number: number;
         status: string;
         total: number;
         estimated_wait: number;
       }

       export async function createPublicOrder(
         slug: string,
         payload: CreateOrderPayload
       ): Promise<OrderResponse> {
         const apiUrl = process.env.NEXT_PUBLIC_API_URL || '';
         const response = await fetch(`${apiUrl}/api/v1/menu/public/${slug}/order/`, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(payload),
         });

         if (!response.ok) {
           const error = await response.json().catch(() => ({}));
           throw new Error(error.detail || 'Failed to create order');
         }

         return response.json();
       }
       ```

    2. Create apps/web/app/[locale]/menu/[slug]/layout.tsx:
       ```typescript
       import { CartProvider } from '@/lib/store/cartStore';

       export default function MenuLayout({ children }: { children: React.ReactNode }) {
         return (
           <CartProvider>
             <div className="min-h-screen bg-gray-50">
               {children}
             </div>
           </CartProvider>
         );
       }
       ```

    3. Create apps/web/app/[locale]/menu/[slug]/page.tsx:
       ```typescript
       'use client';

       import { useState } from 'react';
       import { useParams } from 'next/navigation';
       import { useTranslations } from 'next-intl';
       import { usePublicMenu } from '@/lib/hooks/usePublicMenu';
       import { useCart } from '@/lib/hooks/useCart';
       import { PublicMenuGrid } from '@/components/menu/PublicMenuGrid';
       import { CustomerCart } from '@/components/menu/CustomerCart';
       import { LocaleSwitcher } from '@/components/ui/LocaleSwitcher';

       export default function PublicMenuPage() {
         const params = useParams();
         const slug = params.slug as string;
         const t = useTranslations('pos');
         const { data, isLoading, error } = usePublicMenu(slug);
         const { itemCount, total } = useCart();
         const [showCart, setShowCart] = useState(false);

         if (isLoading) {
           return (
             <div className="flex items-center justify-center min-h-screen">
               <p className="text-gray-500">{t('menu.title')}...</p>
             </div>
           );
         }

         if (error) {
           return (
             <div className="flex items-center justify-center min-h-screen">
               <div className="text-center">
                 <p className="text-red-500 mb-2">Restaurant not found</p>
                 <p className="text-gray-500 text-sm">
                   Please check the QR code and try again
                 </p>
               </div>
             </div>
           );
         }

         if (!data) return null;

         return (
           <div className="pb-24">
             {/* Header */}
             <header className="bg-white shadow-sm sticky top-0 z-10">
               <div className="max-w-lg mx-auto px-4 py-3">
                 <div className="flex items-center justify-between">
                   <div>
                     <h1 className="text-xl font-bold">{data.restaurant.name}</h1>
                     {data.restaurant.address && (
                       <p className="text-sm text-gray-500">{data.restaurant.address}</p>
                     )}
                   </div>
                   <LocaleSwitcher />
                 </div>
               </div>
             </header>

             {/* Menu */}
             <main className="max-w-lg mx-auto px-4 py-4">
               {data.categories.map(category => (
                 <div key={category.id} className="mb-6">
                   <h2 className="text-lg font-bold mb-3 sticky top-16 bg-gray-50 py-2">
                     {category.name}
                   </h2>
                   <PublicMenuGrid items={category.items} />
                 </div>
               ))}
             </main>

             {/* Cart FAB */}
             {itemCount > 0 && (
               <button
                 onClick={() => setShowCart(true)}
                 className="fixed bottom-4 left-4 right-4 max-w-lg mx-auto bg-blue-600 text-white py-4 rounded-lg shadow-lg flex items-center justify-between px-6"
               >
                 <span className="flex items-center gap-2">
                   <span className="bg-white/20 px-2 py-1 rounded">{itemCount}</span>
                   <span>{t('cart.title')}</span>
                 </span>
                 <span className="font-bold">{total.toLocaleString()} XOF</span>
               </button>
             )}

             {/* Cart Modal */}
             {showCart && (
               <CustomerCart
                 restaurantSlug={slug}
                 onClose={() => setShowCart(false)}
               />
             )}
           </div>
         );
       }
       ```
  </action>
  <verify>Visit http://localhost:3000/fr/menu/test-restaurant (with valid slug)</verify>
  <done>Public menu page structure with cart FAB ready</done>
</task>

<task type="auto">
  <name>Task 3: Build public menu components</name>
  <files>
    apps/web/components/menu/PublicMenuGrid.tsx
    apps/web/components/menu/PublicMenuItemCard.tsx
    apps/web/components/menu/PublicModifierModal.tsx
  </files>
  <action>
    1. Create apps/web/components/menu/PublicMenuGrid.tsx:
       ```typescript
       'use client';

       import { MenuItem } from '@/lib/api/types';
       import { PublicMenuItemCard } from './PublicMenuItemCard';

       interface PublicMenuGridProps {
         items: MenuItem[];
       }

       export function PublicMenuGrid({ items }: PublicMenuGridProps) {
         if (items.length === 0) {
           return (
             <p className="text-gray-400 text-center py-4">
               No items available
             </p>
           );
         }

         return (
           <div className="space-y-3">
             {items.map(item => (
               <PublicMenuItemCard key={item.id} item={item} />
             ))}
           </div>
         );
       }
       ```

    2. Create apps/web/components/menu/PublicMenuItemCard.tsx:
       ```typescript
       'use client';

       import { useState } from 'react';
       import { MenuItem } from '@/lib/api/types';
       import { useCart } from '@/lib/hooks/useCart';
       import { PublicModifierModal } from './PublicModifierModal';

       // Convert API MenuItem to LocalMenuItem for cart
       function toLocalMenuItem(item: MenuItem) {
         return {
           id: item.id,
           categoryId: item.category,
           name: item.name,
           description: item.description,
           price: item.price,
           thumbnailUrl: item.thumbnail_url,
           isAvailable: item.is_available,
           modifiers: item.modifiers.map(m => ({
             id: m.id,
             name: m.name,
             required: m.required,
             maxSelections: m.max_selections,
             options: m.options.map(o => ({
               id: o.id,
               name: o.name,
               priceAdjustment: o.price_adjustment,
               isAvailable: o.is_available,
             })),
           })),
           syncedAt: new Date(),
         };
       }

       interface PublicMenuItemCardProps {
         item: MenuItem;
       }

       export function PublicMenuItemCard({ item }: PublicMenuItemCardProps) {
         const { addItem } = useCart();
         const [showModifiers, setShowModifiers] = useState(false);

         const handleClick = () => {
           if (item.modifiers.length > 0) {
             setShowModifiers(true);
           } else {
             addItem(toLocalMenuItem(item));
           }
         };

         const handleAddWithModifiers = (
           selectedModifiers: { optionId: string; optionName: string; priceAdjustment: number }[]
         ) => {
           addItem(toLocalMenuItem(item), 1, selectedModifiers);
           setShowModifiers(false);
         };

         return (
           <>
             <button
               onClick={handleClick}
               className="w-full bg-white rounded-lg shadow p-4 text-left flex gap-4"
             >
               {item.thumbnail_url && (
                 <img
                   src={item.thumbnail_url}
                   alt={item.name}
                   className="w-20 h-20 object-cover rounded"
                 />
               )}
               <div className="flex-1">
                 <h3 className="font-medium">{item.name}</h3>
                 {item.description && (
                   <p className="text-sm text-gray-500 line-clamp-2 mt-1">
                     {item.description}
                   </p>
                 )}
                 <p className="text-blue-600 font-bold mt-2">
                   {item.price.toLocaleString()} XOF
                 </p>
               </div>
               <div className="flex items-center">
                 <span className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg">
                   +
                 </span>
               </div>
             </button>

             {showModifiers && (
               <PublicModifierModal
                 item={toLocalMenuItem(item)}
                 onClose={() => setShowModifiers(false)}
                 onAdd={handleAddWithModifiers}
               />
             )}
           </>
         );
       }
       ```

    3. Create apps/web/components/menu/PublicModifierModal.tsx:
       ```typescript
       'use client';

       import { useState } from 'react';
       import { useTranslations } from 'next-intl';
       import { LocalMenuItem } from '@/lib/db/schema';
       import { Button } from '@/components/ui/Button';

       interface PublicModifierModalProps {
         item: LocalMenuItem;
         onClose: () => void;
         onAdd: (modifiers: { optionId: string; optionName: string; priceAdjustment: number }[]) => void;
       }

       export function PublicModifierModal({ item, onClose, onAdd }: PublicModifierModalProps) {
         const t = useTranslations('common');
         const [selectedOptions, setSelectedOptions] = useState<Record<string, string[]>>({});

         const toggleOption = (modifierId: string, optionId: string, maxSelections: number) => {
           setSelectedOptions(prev => {
             const current = prev[modifierId] || [];
             if (current.includes(optionId)) {
               return { ...prev, [modifierId]: current.filter(id => id !== optionId) };
             }
             if (maxSelections === 1) {
               return { ...prev, [modifierId]: [optionId] };
             }
             if (maxSelections === 0 || current.length < maxSelections) {
               return { ...prev, [modifierId]: [...current, optionId] };
             }
             return prev;
           });
         };

         const handleAdd = () => {
           const missingRequired = item.modifiers.filter(
             m => m.required && (!selectedOptions[m.id] || selectedOptions[m.id].length === 0)
           );
           if (missingRequired.length > 0) {
             alert(`Please select: ${missingRequired.map(m => m.name).join(', ')}`);
             return;
           }

           const modifiers: { optionId: string; optionName: string; priceAdjustment: number }[] = [];
           for (const modifier of item.modifiers) {
             const selected = selectedOptions[modifier.id] || [];
             for (const optionId of selected) {
               const option = modifier.options.find(o => o.id === optionId);
               if (option) {
                 modifiers.push({
                   optionId: option.id,
                   optionName: option.name,
                   priceAdjustment: option.priceAdjustment,
                 });
               }
             }
           }

           onAdd(modifiers);
         };

         const totalAdjustment = Object.entries(selectedOptions).reduce((sum, [modifierId, optionIds]) => {
           const modifier = item.modifiers.find(m => m.id === modifierId);
           if (!modifier) return sum;
           return sum + optionIds.reduce((optSum, optId) => {
             const option = modifier.options.find(o => o.id === optId);
             return optSum + (option?.priceAdjustment || 0);
           }, 0);
         }, 0);

         return (
           <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50">
             <div className="bg-white rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-hidden animate-slide-up">
               {/* Header */}
               <div className="p-4 border-b flex items-center justify-between">
                 <div>
                   <h2 className="text-lg font-bold">{item.name}</h2>
                   <p className="text-sm text-gray-500">
                     {item.price.toLocaleString()} XOF
                   </p>
                 </div>
                 <button onClick={onClose} className="text-2xl text-gray-400">
                   &times;
                 </button>
               </div>

               {/* Modifiers */}
               <div className="p-4 overflow-y-auto max-h-[50vh]">
                 {item.modifiers.map(modifier => (
                   <div key={modifier.id} className="mb-4">
                     <h3 className="font-medium mb-2">
                       {modifier.name}
                       {modifier.required && <span className="text-red-500 ml-1">*</span>}
                     </h3>
                     <div className="space-y-2">
                       {modifier.options.filter(o => o.isAvailable).map(option => {
                         const isSelected = (selectedOptions[modifier.id] || []).includes(option.id);
                         return (
                           <button
                             key={option.id}
                             onClick={() => toggleOption(modifier.id, option.id, modifier.maxSelections)}
                             className={`w-full p-3 rounded-lg border text-left flex justify-between ${
                               isSelected
                                 ? 'border-blue-500 bg-blue-50'
                                 : 'border-gray-200'
                             }`}
                           >
                             <span>{option.name}</span>
                             {option.priceAdjustment !== 0 && (
                               <span className="text-blue-600">
                                 {option.priceAdjustment > 0 ? '+' : ''}
                                 {option.priceAdjustment.toLocaleString()} XOF
                               </span>
                             )}
                           </button>
                         );
                       })}
                     </div>
                   </div>
                 ))}
               </div>

               {/* Footer */}
               <div className="p-4 border-t bg-gray-50">
                 <Button onClick={handleAdd} className="w-full" size="lg">
                   {t('add')} - {(item.price + totalAdjustment).toLocaleString()} XOF
                 </Button>
               </div>
             </div>
           </div>
         );
       }
       ```
  </action>
  <verify>Items display and can be added to cart via modifier modal</verify>
  <done>Public menu components with modifier selection ready</done>
</task>

<task type="auto">
  <name>Task 4: Build customer cart and checkout</name>
  <files>
    apps/web/components/menu/CustomerCart.tsx
    apps/web/components/menu/CustomerCheckout.tsx
    apps/web/components/menu/OrderConfirmation.tsx
  </files>
  <action>
    1. Create apps/web/components/menu/CustomerCart.tsx:
       ```typescript
       'use client';

       import { useState } from 'react';
       import { useTranslations } from 'next-intl';
       import { useCart } from '@/lib/hooks/useCart';
       import { CartItem } from '@/lib/store/cartStore';
       import { CustomerCheckout } from './CustomerCheckout';
       import { Button } from '@/components/ui/Button';

       interface CustomerCartProps {
         restaurantSlug: string;
         onClose: () => void;
       }

       export function CustomerCart({ restaurantSlug, onClose }: CustomerCartProps) {
         const t = useTranslations('pos.cart');
         const { items, subtotal, total, updateQuantity, removeItem, clearCart } = useCart();
         const [showCheckout, setShowCheckout] = useState(false);

         if (showCheckout) {
           return (
             <CustomerCheckout
               restaurantSlug={restaurantSlug}
               onBack={() => setShowCheckout(false)}
               onComplete={onClose}
             />
           );
         }

         return (
           <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50">
             <div className="bg-white rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-hidden">
               {/* Header */}
               <div className="p-4 border-b flex items-center justify-between">
                 <h2 className="text-lg font-bold">{t('title')}</h2>
                 <button onClick={onClose} className="text-2xl text-gray-400">
                   &times;
                 </button>
               </div>

               {/* Items */}
               <div className="p-4 overflow-y-auto max-h-[50vh]">
                 {items.length === 0 ? (
                   <p className="text-gray-400 text-center py-8">{t('empty')}</p>
                 ) : (
                   <div className="space-y-3">
                     {items.map(item => (
                       <CustomerCartItem
                         key={item.id}
                         item={item}
                         onUpdateQuantity={(qty) => updateQuantity(item.id, qty)}
                         onRemove={() => removeItem(item.id)}
                       />
                     ))}
                   </div>
                 )}
               </div>

               {/* Footer */}
               {items.length > 0 && (
                 <div className="p-4 border-t bg-gray-50">
                   <div className="flex justify-between mb-2">
                     <span className="text-gray-600">{t('subtotal')}</span>
                     <span>{subtotal.toLocaleString()} XOF</span>
                   </div>
                   <div className="flex justify-between mb-4 text-lg font-bold">
                     <span>{t('total')}</span>
                     <span>{total.toLocaleString()} XOF</span>
                   </div>
                   <Button
                     onClick={() => setShowCheckout(true)}
                     className="w-full"
                     size="lg"
                   >
                     {t('checkout')}
                   </Button>
                 </div>
               )}
             </div>
           </div>
         );
       }

       function CustomerCartItem({
         item,
         onUpdateQuantity,
         onRemove,
       }: {
         item: CartItem;
         onUpdateQuantity: (qty: number) => void;
         onRemove: () => void;
       }) {
         return (
           <div className="flex items-center gap-3 bg-gray-50 rounded-lg p-3">
             <div className="flex-1">
               <h4 className="font-medium">{item.menuItemName}</h4>
               {item.modifiers.length > 0 && (
                 <p className="text-sm text-gray-500">
                   {item.modifiers.map(m => m.optionName).join(', ')}
                 </p>
               )}
               <p className="text-blue-600 font-medium mt-1">
                 {(item.unitPrice * item.quantity).toLocaleString()} XOF
               </p>
             </div>
             <div className="flex items-center gap-2">
               <button
                 onClick={() => onUpdateQuantity(item.quantity - 1)}
                 className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center"
               >
                 -
               </button>
               <span className="w-6 text-center">{item.quantity}</span>
               <button
                 onClick={() => onUpdateQuantity(item.quantity + 1)}
                 className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center"
               >
                 +
               </button>
             </div>
           </div>
         );
       }
       ```

    2. Create apps/web/components/menu/CustomerCheckout.tsx:
       ```typescript
       'use client';

       import { useState } from 'react';
       import { useTranslations } from 'next-intl';
       import { useCart } from '@/lib/hooks/useCart';
       import { createPublicOrder } from '@/lib/hooks/usePublicMenu';
       import { OrderConfirmation } from './OrderConfirmation';
       import { Button } from '@/components/ui/Button';

       interface CustomerCheckoutProps {
         restaurantSlug: string;
         onBack: () => void;
         onComplete: () => void;
       }

       export function CustomerCheckout({
         restaurantSlug,
         onBack,
         onComplete,
       }: CustomerCheckoutProps) {
         const t = useTranslations('pos.order');
         const tCommon = useTranslations('common');
         const { items, total, clearCart } = useCart();

         const [orderType, setOrderType] = useState<'dine_in' | 'takeout'>('dine_in');
         const [tableNumber, setTableNumber] = useState('');
         const [customerName, setCustomerName] = useState('');
         const [customerPhone, setCustomerPhone] = useState('');
         const [isSubmitting, setIsSubmitting] = useState(false);
         const [orderResult, setOrderResult] = useState<{
           orderNumber: number;
           total: number;
           estimatedWait: number;
         } | null>(null);

         const handleSubmit = async () => {
           // Validation
           if (orderType === 'dine_in' && !tableNumber.trim()) {
             alert('Please enter your table number');
             return;
           }
           if (!customerName.trim()) {
             alert('Please enter your name');
             return;
           }

           setIsSubmitting(true);
           try {
             const result = await createPublicOrder(restaurantSlug, {
               order_type: orderType,
               table: orderType === 'dine_in' ? tableNumber : undefined,
               customer_name: customerName,
               customer_phone: customerPhone,
               items: items.map(item => ({
                 menu_item_id: item.menuItemId,
                 quantity: item.quantity,
                 notes: item.notes || undefined,
                 modifiers: item.modifiers.map(m => ({ modifier_option_id: m.optionId })),
               })),
             });

             setOrderResult({
               orderNumber: result.order_number,
               total: result.total,
               estimatedWait: result.estimated_wait,
             });
             clearCart();
           } catch (error) {
             alert(error instanceof Error ? error.message : 'Failed to submit order');
           } finally {
             setIsSubmitting(false);
           }
         };

         if (orderResult) {
           return (
             <OrderConfirmation
               orderNumber={orderResult.orderNumber}
               total={orderResult.total}
               estimatedWait={orderResult.estimatedWait}
               onClose={onComplete}
             />
           );
         }

         return (
           <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50">
             <div className="bg-white rounded-t-2xl w-full max-w-lg max-h-[80vh] overflow-hidden">
               {/* Header */}
               <div className="p-4 border-b flex items-center">
                 <button onClick={onBack} className="mr-4 text-gray-500">
                   &larr;
                 </button>
                 <h2 className="text-lg font-bold">{t('submit')}</h2>
               </div>

               {/* Form */}
               <div className="p-4 space-y-4 overflow-y-auto max-h-[50vh]">
                 {/* Order Type */}
                 <div>
                   <label className="block text-sm font-medium text-gray-700 mb-2">
                     {t('type')}
                   </label>
                   <div className="flex gap-2">
                     <button
                       onClick={() => setOrderType('dine_in')}
                       className={`flex-1 py-3 rounded-lg border-2 ${
                         orderType === 'dine_in'
                           ? 'border-blue-500 bg-blue-50'
                           : 'border-gray-200'
                       }`}
                     >
                       {t('dineIn')}
                     </button>
                     <button
                       onClick={() => setOrderType('takeout')}
                       className={`flex-1 py-3 rounded-lg border-2 ${
                         orderType === 'takeout'
                           ? 'border-blue-500 bg-blue-50'
                           : 'border-gray-200'
                       }`}
                     >
                       {t('takeout')}
                     </button>
                   </div>
                 </div>

                 {/* Table Number (for dine-in) */}
                 {orderType === 'dine_in' && (
                   <div>
                     <label className="block text-sm font-medium text-gray-700 mb-2">
                       {t('table')} *
                     </label>
                     <input
                       type="text"
                       value={tableNumber}
                       onChange={e => setTableNumber(e.target.value)}
                       placeholder="e.g. Table 5"
                       className="w-full p-3 border rounded-lg"
                     />
                   </div>
                 )}

                 {/* Customer Name */}
                 <div>
                   <label className="block text-sm font-medium text-gray-700 mb-2">
                     Your Name *
                   </label>
                   <input
                     type="text"
                     value={customerName}
                     onChange={e => setCustomerName(e.target.value)}
                     className="w-full p-3 border rounded-lg"
                   />
                 </div>

                 {/* Phone (optional) */}
                 <div>
                   <label className="block text-sm font-medium text-gray-700 mb-2">
                     Phone (optional)
                   </label>
                   <input
                     type="tel"
                     value={customerPhone}
                     onChange={e => setCustomerPhone(e.target.value)}
                     placeholder="+225"
                     className="w-full p-3 border rounded-lg"
                   />
                 </div>

                 {/* Total */}
                 <div className="pt-4 border-t">
                   <div className="flex justify-between text-lg font-bold">
                     <span>Total</span>
                     <span>{total.toLocaleString()} XOF</span>
                   </div>
                 </div>
               </div>

               {/* Submit */}
               <div className="p-4 border-t bg-gray-50">
                 <Button
                   onClick={handleSubmit}
                   disabled={isSubmitting}
                   className="w-full"
                   size="lg"
                 >
                   {isSubmitting ? tCommon('loading') : t('submit')}
                 </Button>
               </div>
             </div>
           </div>
         );
       }
       ```

    3. Create apps/web/components/menu/OrderConfirmation.tsx:
       ```typescript
       'use client';

       import { Button } from '@/components/ui/Button';

       interface OrderConfirmationProps {
         orderNumber: number;
         total: number;
         estimatedWait: number;
         onClose: () => void;
       }

       export function OrderConfirmation({
         orderNumber,
         total,
         estimatedWait,
         onClose,
       }: OrderConfirmationProps) {
         return (
           <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
             <div className="bg-white rounded-2xl w-full max-w-sm p-6 text-center">
               <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                 <svg className="w-8 h-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                   <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                 </svg>
               </div>

               <h2 className="text-2xl font-bold mb-2">Order Confirmed!</h2>

               <div className="bg-gray-100 rounded-lg p-4 my-4">
                 <p className="text-gray-500 text-sm">Order Number</p>
                 <p className="text-4xl font-bold text-blue-600">#{orderNumber}</p>
               </div>

               <p className="text-gray-600 mb-2">
                 Total: <span className="font-bold">{total.toLocaleString()} XOF</span>
               </p>

               <p className="text-gray-500 text-sm mb-6">
                 Estimated wait: ~{estimatedWait} minutes
               </p>

               <p className="text-sm text-gray-400 mb-4">
                 Your order has been sent to the kitchen.
                 Please wait for your number to be called.
               </p>

               <Button onClick={onClose} className="w-full">
                 Done
               </Button>
             </div>
           </div>
         );
       }
       ```
  </action>
  <verify>Complete customer order flow: view menu, add items, checkout, see confirmation</verify>
  <done>Customer cart and checkout with order confirmation ready</done>
</task>

</tasks>

<verification>
1. Public menu loads at /menu/[slug] without login
2. Restaurant info displays in header
3. Categories and items display correctly
4. Items can be added to cart with modifiers
5. Cart shows correct totals
6. Checkout collects customer info
7. Order submission creates order on backend
8. Confirmation shows order number and estimated wait
9. Works on mobile viewport (responsive)
</verification>

<success_criteria>
- Public menu page accessible without authentication
- Menu displays restaurant name and available items only
- Modifier selection works for items with options
- Cart FAB shows item count and total
- Checkout form collects order type, table (dine-in), customer name
- Order creates via public API endpoint
- Confirmation shows order number for pickup
- Mobile-first responsive design
- French/English language support
</success_criteria>

<output>
After completion, create `.planning/phases/02-pos-core/02-07-SUMMARY.md`
</output>
